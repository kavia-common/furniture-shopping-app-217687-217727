pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
    // Fallback explicit versions if CI environment cannot discover com.android.application
    // via the local cache. These will be used only if module build files don't specify versions.
    plugins {
        id("com.android.application") version "8.6.1"
        id("org.jetbrains.kotlin.android") version "2.0.21"
        // dev.flutter.flutter-gradle-plugin is resolved from local includeBuild below
    }
}

// Read flutter.sdk from local.properties for local plugin resolution
def flutterSdk = null
def localPropertiesFile = new File(rootDir, "local.properties")
if (localPropertiesFile.exists()) {
    def Properties p = new Properties()
    localPropertiesFile.withInputStream { is -> p.load(is) }
    def lpFlutter = p.getProperty("flutter.sdk")
    if (lpFlutter != null && !lpFlutter.trim().isEmpty()) {
        flutterSdk = lpFlutter
    }
}

// Include Flutter tools Gradle build to resolve dev.flutter.flutter-gradle-plugin locally
if (flutterSdk != null && new File(flutterSdk).exists()) {
    includeBuild("${flutterSdk}/packages/flutter_tools/gradle")
} else {
    println("Warning: Flutter SDK path not found in local.properties (flutter.sdk). Set it to enable dev.flutter.flutter-gradle-plugin.")
}

dependencyResolutionManagement {
    // Prefer allowing project repositories so Flutter's Gradle plugin can add its own as needed.
    // Using PREFER_PROJECT to avoid build failures introduced by FAIL_ON_PROJECT_REPOS.
    repositoriesMode.set(RepositoriesMode.PREFER_PROJECT)
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}

rootProject.name = "MobileApp"
include(":app")
