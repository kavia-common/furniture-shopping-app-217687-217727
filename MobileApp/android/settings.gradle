pluginManagement {
    // Ensure plugin repositories are available to resolve plugins via the plugins DSL
    repositories {
        // Keep standard sources
        google()
        mavenCentral()
        gradlePluginPortal()
        // Add Flutter Android artifacts repository
        maven { url 'https://storage.googleapis.com/download.flutter.io' }
    }
    // Explicit plugin versions so module build files can resolve without legacy buildscript
    plugins {
        id("com.android.application") version "8.6.1"
        id("org.jetbrains.kotlin.android") version "2.0.21"
        // Explicitly declare the Flutter Gradle plugin version for metadata; actual resolution via includeBuild below
        id("dev.flutter.flutter-gradle-plugin") version "1.0.0"
    }
}

// Read flutter.sdk from local.properties for local plugin resolution
def flutterSdk = null
def localPropertiesFile = new File(rootDir, "local.properties")
if (localPropertiesFile.exists()) {
    def Properties p = new Properties()
    localPropertiesFile.withInputStream { is -> p.load(is) }
    def lpFlutter = p.getProperty("flutter.sdk")
    if (lpFlutter != null && !lpFlutter.trim().isEmpty()) {
        flutterSdk = lpFlutter
    }
}

// Include Flutter tools Gradle build to resolve dev.flutter.flutter-gradle-plugin locally
if (flutterSdk != null && new File(flutterSdk).exists()) {
    includeBuild("${flutterSdk}/packages/flutter_tools/gradle")
} else {
    println("Warning: Flutter SDK path not found in local.properties (flutter.sdk). Set it to enable dev.flutter.flutter-gradle-plugin.")
}

dependencyResolutionManagement {
    // Prefer project-level repositories to allow plugin-added repos (e.g., Flutter)
    repositoriesMode.set(RepositoriesMode.PREFER_PROJECT)
    repositories {
        // Ensure standard sources and Flutter artifacts repository are present
        google()
        mavenCentral()
        maven { url 'https://storage.googleapis.com/download.flutter.io' }
    }
}

rootProject.name = "MobileApp"
include(":app")
