pluginManagement {
    // Ensure plugin repositories are available to resolve plugins via the plugins DSL
    repositories {
        // Both pluginManagement and dependencyResolutionManagement must include these
        google()
        mavenCentral()
        gradlePluginPortal()
    }
    // Explicit plugin versions so module build files can resolve without legacy buildscript
    plugins {
        id("com.android.application") version "8.6.1"
        id("org.jetbrains.kotlin.android") version "2.0.21"
        // Explicitly declare the Flutter Gradle plugin version for metadata; actual resolution via includeBuild below
        id("dev.flutter.flutter-gradle-plugin") version "1.0.0"
    }
}

// Read flutter.sdk from local.properties for local plugin resolution
def flutterSdk = null
def localPropertiesFile = new File(rootDir, "local.properties")
if (localPropertiesFile.exists()) {
    def Properties p = new Properties()
    localPropertiesFile.withInputStream { is -> p.load(is) }
    def lpFlutter = p.getProperty("flutter.sdk")
    if (lpFlutter != null && !lpFlutter.trim().isEmpty()) {
        flutterSdk = lpFlutter
    }
}

// Include Flutter tools Gradle build to resolve dev.flutter.flutter-gradle-plugin locally
if (flutterSdk != null && new File(flutterSdk).exists()) {
    includeBuild("${flutterSdk}/packages/flutter_tools/gradle")
} else {
    println("Warning: Flutter SDK path not found in local.properties (flutter.sdk). Set it to enable dev.flutter.flutter-gradle-plugin.")
}

dependencyResolutionManagement {
    // Prefer settings repositories to avoid plugin adding project-level repositories
    repositoriesMode.set(RepositoriesMode.PREFER_SETTINGS)
    repositories {
        // Ensure both google and mavenCentral and gradlePluginPortal are present
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}

rootProject.name = "MobileApp"
include(":app")
