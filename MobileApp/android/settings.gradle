pluginManagement {
  repositories {
    // Deterministic plugin resolution sources
    google()
    mavenCentral()
    gradlePluginPortal()
    maven { url 'https://storage.googleapis.com/download.flutter.io' }
  }
  // Explicit plugin versions so Gradle can resolve without legacy buildscript
  plugins {
    id('com.android.application') version '8.6.1'
    id('org.jetbrains.kotlin.android') version '2.0.21'
  }
}

// Load flutter.sdk from local.properties; fallback to env or /opt/flutter
def flutterSdk = {
  def props = new Properties()
  def propsFile = new File(rootDir, "local.properties")
  if (propsFile.exists()) {
    propsFile.withInputStream { stream -> props.load(stream) }
  }
  def sdk = props.getProperty("flutter.sdk")
  if (sdk == null || sdk.trim().isEmpty()) {
    sdk = System.getenv("FLUTTER_HOME")
  }
  if (sdk == null || sdk.trim().isEmpty()) {
    sdk = "/opt/flutter"
  }
  return sdk
}.call()

// Keep Flutter tools included for dev.flutter.flutter-gradle-plugin
includeBuild("${flutterSdk}/packages/flutter_tools/gradle")

dependencyResolutionManagement {
  // Prefer settings repositories to ensure CI plugin/dependency resolution consistency
  repositoriesMode.set(RepositoriesMode.PREFER_SETTINGS)
  repositories {
    google()
    mavenCentral()
    maven { url 'https://storage.googleapis.com/download.flutter.io' }
  }
}

include(":app")
