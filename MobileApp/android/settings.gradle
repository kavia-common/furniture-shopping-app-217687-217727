pluginManagement {
  repositories {
    // Required repositories for Android/Flutter (order matters)
    google()
    mavenCentral()
    gradlePluginPortal()
    // Flutter artifacts repository (kept last to avoid overshadowing)
    maven { url 'https://storage.googleapis.com/download.flutter.io' }
  }
  // Explicit plugin versions to ensure CI resolution
  plugins {
    id "com.android.application" version "8.6.1"
    id "org.jetbrains.kotlin.android" version "2.0.21"
  }
}

// Read flutter.sdk from local.properties to include Flutter toolchain build
def props = new Properties()
def lp = file('local.properties')
if (lp.exists()) {
  lp.withInputStream { props.load(it) }
}
def flutterSdk = props.getProperty('flutter.sdk')
if (flutterSdk == null || flutterSdk.trim().isEmpty()) {
  // Fallback to environment if local.properties not set
  flutterSdk = System.getenv('FLUTTER_HOME')
}
if (flutterSdk != null && flutterSdk.trim()) {
  // Include Flutter tools build so dev.flutter.flutter-gradle-plugin is available
  includeBuild("${flutterSdk}/packages/flutter_tools/gradle")
}

dependencyResolutionManagement {
  // Prefer settings to define repositories to keep them centralized
  repositoriesMode.set(RepositoriesMode.PREFER_SETTINGS)
  repositories {
    // Keep Google and Maven Central first
    google()
    mavenCentral()
    // Keep Flutter artifacts repository available
    maven { url 'https://storage.googleapis.com/download.flutter.io' }
  }
}

include(":app")
